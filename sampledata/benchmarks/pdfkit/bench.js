const PDFDocument = require("pdfkit-table");
const fs = require("fs");
const { performance } = require("perf_hooks");

const data = JSON.parse(fs.readFileSync("../data.json", "utf8"));

const start = performance.now();
const doc = new PDFDocument({ margin: 30, size: 'A4' });

const stream = fs.createWriteStream("output_pdfkit.pdf");
doc.pipe(stream);

doc.fontSize(16).text("User Report", { align: "center" });
doc.moveDown();

const table = {
    title: "",
    headers: ["ID", "Name", "Email", "Role", "Description"],
    rows: data.map(r => [String(r.id), r.name, r.email, r.role, r.desc]),
};

doc.table(table, {
    prepareHeader: () => doc.font("Helvetica-Bold").fontSize(10),
    prepareRow: (row, indexColumn, indexRow, rect, rectRow) => doc.font("Helvetica").fontSize(10),
});

doc.text("Generated by PDFKit", { align: "center" });

doc.end();

stream.on("finish", () => {
    const end = performance.now();
    console.log(`PDFKit Time: ${(end - start).toFixed(2)} ms`);
});
