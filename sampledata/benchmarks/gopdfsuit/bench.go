package main

import (
	"encoding/json"
	"fmt"
	"os"
	"time"

	"github.com/chinmay-sawant/gopdfsuit/pkg/gopdflib"
)

type UserRecord struct {
	ID    int    `json:"id"`
	Name  string `json:"name"`
	Email string `json:"email"`
	Role  string `json:"role"`
	Desc  string `json:"desc"`
}

func main() {
	// Load data
	dataFile, err := os.ReadFile("../data.json")
	if err != nil {
		fmt.Println("Error reading data.json:", err)
		os.Exit(1)
	}

	var data []UserRecord
	if err := json.Unmarshal(dataFile, &data); err != nil {
		fmt.Println("Error parsing JSON:", err)
		os.Exit(1)
	}

	start := time.Now()

	// Create styled table rows
	tableRows := make([]gopdflib.Row, len(data)+1)

	// Header row with bold text and gray background
	tableRows[0] = gopdflib.Row{
		Row: []gopdflib.Cell{
			{Props: "Helvetica:10:100:left:0:0:1:1", Text: "ID", BgColor: "#E0E0E0"},
			{Props: "Helvetica:10:100:left:0:0:1:1", Text: "Name", BgColor: "#E0E0E0"},
			{Props: "Helvetica:10:100:left:0:0:1:1", Text: "Email", BgColor: "#E0E0E0"},
			{Props: "Helvetica:10:100:left:0:0:1:1", Text: "Role", BgColor: "#E0E0E0"},
			{Props: "Helvetica:10:100:left:0:0:1:1", Text: "Description", BgColor: "#E0E0E0"},
		},
	}

	// Data rows with alternating colors
	for i, record := range data {
		bgColor := "#FFFFFF"
		if i%2 == 1 {
			bgColor = "#F8F8F8"
		}
		tableRows[i+1] = gopdflib.Row{
			Row: []gopdflib.Cell{
				{Props: "Helvetica:10:000:left:0:0:0:1", Text: fmt.Sprintf("%d", record.ID), BgColor: bgColor},
				{Props: "Helvetica:10:000:left:0:0:0:1", Text: record.Name, BgColor: bgColor},
				{Props: "Helvetica:10:000:left:0:0:0:1", Text: record.Email, BgColor: bgColor},
				{Props: "Helvetica:10:000:left:0:0:0:1", Text: record.Role, BgColor: bgColor},
				{Props: "Helvetica:10:000:left:0:0:0:1", Text: record.Desc, BgColor: bgColor},
			},
		}
	}

	// Create PDF template with PDF/A-4 and PDF 2.0 compliance
	template := gopdflib.PDFTemplate{
		Config: gopdflib.Config{
			Page:          "A4",
			PageAlignment: 1, // Portrait
			PdfTitle:      "User Report",
			// Enable PDF/A-4 compliance (PDF 2.0 based)
			PDFA: &gopdflib.PDFAConfig{
				Enabled:     true,
				Conformance: "4", // PDF/A-4 (PDF 2.0 based, highest standard)
				Title:       "User Report",
				Author:      "Benchmark System",
				Subject:     "User data report for benchmarking",
				Creator:     "GoPDFSuit Benchmark",
				Keywords:    "users, report, benchmark, PDF/A-4, PDF 2.0",
			},
			ArlingtonCompatible: true, // Enable PDF 2.0 Arlington Model compliance
		},
		Title: gopdflib.Title{
			Props: "Helvetica:18:100:center:0:0:0:0",
			Text:  "User Report",
		},
		Elements: []gopdflib.Element{
			{
				Type: "spacer",
				Spacer: &gopdflib.Spacer{
					Height: 10,
				},
			},
			{
				Type: "table",
				Table: &gopdflib.Table{
					MaxColumns:   5,
					ColumnWidths: []float64{0.5, 1.5, 2, 1.5, 3}, // ID, Name, Email, Role, Description
					Rows:         tableRows,
				},
			},
		},
		Footer: gopdflib.Footer{
			Font: "Helvetica:8:000:center:0:0:0:0",
			Text: "Generated by GoPDFSuit (PDF/A-4, PDF 2.0)",
		},
	}

	// Generate PDF
	pdfBytes, err := gopdflib.GeneratePDF(template)
	if err != nil {
		fmt.Println("Error generating PDF:", err)
		os.Exit(1)
	}

	// Write output
	if err := os.WriteFile("output.pdf", pdfBytes, 0644); err != nil {
		fmt.Println("Error writing PDF:", err)
		os.Exit(1)
	}

	elapsed := time.Since(start)
	fmt.Printf("GoPDFSuit Time: %.2f ms\n", float64(elapsed.Nanoseconds())/1_000_000)
	fmt.Println("PDF Standard: PDF/A-4 (PDF 2.0 based)")
}
