const { PDFDocument, StandardFonts, rgb } = require('pdf-lib');
const fs = require('fs');
const { performance } = require('perf_hooks');

const data = JSON.parse(fs.readFileSync('../data.json', 'utf8'));

async function run() {
    const start = performance.now();
    const pdfDoc = await PDFDocument.create();
    const font = await pdfDoc.embedFont(StandardFonts.Helvetica);
    const fontSize = 10;

    let page = pdfDoc.addPage();
    let { width, height } = page.getSize();
    let y = height - 50;

    page.drawText('User Report', { x: 50, y: y, size: 18, font: font });
    y -= 30;

    // pdf-lib does not support automatic page wrapping or tables.
    // We simulate a simple list output.

    for (const row of data) {
        if (y < 50) {
            page = pdfDoc.addPage();
            y = height - 50;
        }

        const text = `${row.id} | ${row.name} | ${row.email} | ${row.role}`;
        // Basic truncation to prevent overflow as we don't have text wrapping calculation here
        let safeText = text.length > 80 ? text.substring(0, 77) + "..." : text;

        page.drawText(safeText, { x: 50, y: y, size: fontSize, font: font });
        y -= 15;
    }

    page.drawText('Generated by pdf-lib', { x: 50, y: y - 20, size: 10, font: font });

    const pdfBytes = await pdfDoc.save();
    fs.writeFileSync('output_pdflib.pdf', pdfBytes);

    const end = performance.now();
    console.log(`pdf-lib Time: ${(end - start).toFixed(2)} ms`);
}

run();
