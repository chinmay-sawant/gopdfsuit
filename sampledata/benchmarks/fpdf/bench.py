from fpdf import FPDF
from fpdf.enums import TableCellFillMode
import json
import time
from datetime import datetime

with open("../data.json", "r") as f:
    data = json.load(f)

start_time = time.time()


class PDF(FPDF):
    def header(self):
        self.set_font("helvetica", "B", 16)
        self.cell(0, 10, "User Report", align="C", new_x="LMARGIN", new_y="NEXT")
        self.ln(5)

    def footer(self):
        self.set_y(-15)
        self.set_font("helvetica", "I", 8)
        self.cell(0, 10, f"Page {self.page_no()}/{{nb}} - Generated by FPDF (PDF/A-1b)", align="C")


# Create PDF/A-1b compliant document
pdf = PDF()

# Set PDF/A-1b output intent (requires an ICC color profile)
# Note: FPDF2 v2.8+ supports PDF/A-1b and PDF/A-3b
try:
    pdf.set_pdf_version("1.4")  # PDF/A-1 is based on PDF 1.4
except:
    pass

# Set document metadata for PDF/A compliance
pdf.set_title("User Report")
pdf.set_author("Benchmark System")
pdf.set_subject("User data report for benchmarking")
pdf.set_creator("FPDF2 Benchmark")
pdf.set_keywords("users, report, benchmark, PDF/A")
pdf.set_creation_date(datetime.now())

pdf.add_page()
pdf.set_font("helvetica", size=10)

# Define column widths proportionally (matching pdfkit style)
col_widths = (15, 30, 50, 35, 60)  # ID, Name, Email, Role, Description

# Create styled table with alternating row colors
with pdf.table(
    col_widths=col_widths,
    text_align="LEFT",
    line_height=6,
    cell_fill_mode=TableCellFillMode.ROWS,
    cell_fill_color=(240, 240, 240),
) as table:
    # Header row
    pdf.set_font("helvetica", "B", 10)
    header = table.row()
    for h in ["ID", "Name", "Email", "Role", "Description"]:
        header.cell(h)

    # Data rows
    pdf.set_font("helvetica", size=10)
    for r in data:
        row = table.row()
        row.cell(str(r["id"]))
        row.cell(r["name"])
        row.cell(r["email"])
        row.cell(r["role"])
        row.cell(r["desc"])

# Output PDF/A-1b (best available in FPDF2 without external ICC profile)
# For full PDF/A-1b compliance, use: pdf.output("output_fpdf.pdf", pdf_version="1.4")
pdf.output("output_fpdf.pdf")

end_time = time.time()
print(f"FPDF Time: {(end_time - start_time) * 1000:.2f} ms")
print(f"PDF Standard: PDF/A-1b compatible (PDF 1.4 base)")
