# Benchmark Comparison - 1.24 Optimization 6 vs 1.24 Optimization 5

This report compares the performance results of the **GoPdfSuit** API running on Go 1.24 (Optimization 6) against the previous best baseline (Optimization 5).

## Test Environment

- **Current Version:** Go 1.24 (Optimization 6 - Hotpath & Allocation Optimization)
- **Previous Version:** Go 1.24 (Optimization 5 - Lock-free Font Registry & Reference Caching)
- **Date:** 2026-02-15
- **CPU:** 13th Gen Intel(R) Core(TM) i7-13700HX (24 cores)

## Optimization Details (v1.24 Opt 6)

1. **CPU Hotpath Optimization**:
   - Targeted hottest CPU paths identified from pprof analysis to reduce execution time.
2. **Allocation Reduction**:
   - Eliminated unnecessary allocations in critical paths, reducing GC pressure.
3. **Format Overhead Reduction**:
   - Removed expensive `fmt.Sprintf` calls in high-frequency loops.
4. **Zlib Writer Pooling**:
   - Switched to pooled zlib writers to avoid repeated initialization and allocation overhead during compression.

## Benchmark Results Comparison (k6 Spike Test - 100 VU)

| Metric             | v1.24 (Opt 5) | v1.24 (Opt 6)   | Change              |
| :----------------- | :------------ | :-------------- | :------------------ |
| **Total Requests** | 8,262         | **8,295**       | +0.4% (Better)      |
| **Throughput**     | 82.32 req/s   | **82.79 req/s** | +0.6% (Better)      |
| **Avg Latency**    | 12.50ms       | **10.67ms**     | **-14.6% (Faster)** |
| **p95 Latency**    | 90.40ms       | **73.77ms**     | **-18.4% (Faster)** |
| **p99 Latency**    | 152.69ms      | **115.99ms**    | **-24.0% (Faster)** |
| **Max Latency**    | 210.23ms      | 414.73ms        | +97.3% (Slower)     |

## Observations

- **Significant Latency Reduction:** Average latency dropped by nearly **15%** to **10.67ms**, and p99 latency improved by **24%**, demonstrating the effectiveness of the hotpath and allocation optimizations.
- **Throughput Stability:** Throughput saw a marginal increase, maintaining the high performance achieved in Optimization 5.
- **Max Latency Regression:** Max latency increased significantly (414ms vs 210ms). This could be an outlier due to the non-deterministic nature of spike tests or increased contention from higher efficiency pushing the system harder in bursts.
- **Improved Consistency:** Despite the max latency outlier, the p95 and p99 metrics show that the system is generally more consistent and faster for the vast majority of requests.

> **Conclusion:** Optimization 6 successfully refined the codebase by targeting specific CPU and allocation bottlenecks. The result is a faster and more responsive API, with average responses appearing almost instantaneous (10ms). The regression in max latency should be monitored but is outweighed by the substantial gains in average and tail latencies.
