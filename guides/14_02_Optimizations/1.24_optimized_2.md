# Benchmark Comparison - v1.24 Optimized v2

This report compares the performance results of the **GoPdfSuit** API after further optimizations (v2) against the previous optimized version (v1.24 Optimized).

## Test Environment

- **Go Version:** 1.26 (Running on host)
- **Architecture:** linux/amd64
- **Date:** 2026-02-14
- **Optimizations Applied in v2:**
  - `fmtNum` optimization (replaced `fmt.Sprintf` with `strconv.AppendFloat`)
  - `IsCustomFont` map pre-allocation (package-level var)
  - `EncodeTextForCustomFont` hex lookup table
  - Pooled zlib writers for font generation
  - Elimination of `fmt.Sprintf` in hot generator loops

## Benchmark Results Comparison

### 1. General Performance

| Test Scenario           | Total Req | Throughput (req/s) | Avg Latency | p95 Latency | p99 Latency  |
| :---------------------- | :-------- | :----------------- | :---------- | :---------- | :----------- |
| **Smoke & Load (v1)**   | 81        | 2.68               | 17.88ms     | 12.83ms     | 313.38ms     |
| **Smoke & Load (v2)**   | 81        | **2.66**           | **16.98ms** | **8.34ms**  | **259.98ms** |
|                         |           |                    |             |             |              |
| **Spike - 100 VU (v1)** | 7,891     | 78.64              | 35.39ms     | 324.49ms    | 575.54ms     |
| **Spike - 100 VU (v2)** | 8,099     | **80.61**          | **22.80ms** | **36.51ms** | **382.31ms** |
|                         |           |                    |             |             |              |
| **Soak (v1)**           | 597       | 4.90               | 23.15ms     | 26.73ms     | 349.87ms     |
| **Soak (v2)**           | 600       | **4.92**           | **17.85ms** | **18.90ms** | **302.26ms** |

### 2. Improvement Metrics (Spike Test)

| Metric          | v1.24 (Optimized v1) | v1.24 (Optimized v2) | Change                   |
| :-------------- | :------------------- | :------------------- | :----------------------- |
| **Throughput**  | 78.64 req/s          | **80.61 req/s**      | +2.5%                    |
| **Avg Latency** | 35.39ms              | **22.80ms**          | **-35.6%** (1.5x Faster) |
| **p95 Latency** | 324.49ms             | **36.51ms**          | **-88.7%** (8.9x Faster) |
| **p99 Latency** | 575.54ms             | **382.31ms**         | **-33.6%** (1.5x Faster) |

## Observations

- **Massive Tail Latency Reduction:** The p95 latency during the 100 VU spike dropped by **89%**, from 324ms down to just 36ms. This is likely due to the elimination of map allocations and string formatting overhead in the content generation hot paths.
- **Consistent Throughput:** Throughput remained stable and slightly improved (+2.5%), reaching its limit under the current k6 script configuration.
- **Improved Average Response:** Average latency improved by over 35%, confirming that the micro-optimizations across `draw.go`, `fonts.go`, and `generator.go` have a substantial cumulative effect.
- **Soak Test Stability:** The soak test shows extremely low average latency (~17.8ms), indicating the pooling mechanisms for `zlib` writers and buffers are effectively managing memory pressure over time.
